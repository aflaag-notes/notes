\ProvidesPackage{nyx-frames}[Nyx Frames]

% \commandbox{inner_text}       --> Without starting >
% \commandbox*{inner_text}      --> With starting >
%
% Creates a new inline tcbox environment used for Markdown-like inline commands

\NewTotalTCBox{\commandbox}{ s v }
{
    verbatim,
    colupper=white,
    colback=black!75!white,
    colframe=black
}
{
    \IfBooleanT{#1}{\textcolor{red!60}{\ttfamily\bfseries > }}%
    \lstinline[language=bash,keywordstyle=\color{blue!35!white}\bfseries]^#2^
}

% \newcustomtcbox{box_name}{box_description}{box_color}
%
% Creates a new tcbox environment with the given properties

\newcommand{\newcustomtcbox}[3]{
    \newtcolorbox[
        auto counter,
        % number within=subsection,   % RIMUOVERE LA RIGA PER IL CONTEGGIO ASSOLUTO
        crefname={#2}{#2}           % use \cref{...} to display box counter in reference
    ]
    {#1}      % environment name
    [2]       % number of arguments (1 optional + mandatories, in that order)
    []        % default value of the optional argument
    {
        ##1,
        skin=enhanced,
        attach boxed title to top left={xshift=12.5mm,yshift=-0.5mm},
        fonttitle=\bfseries,
        varwidth boxed title=0.8 \linewidth,
        colbacktitle=#3,
        colframe=#3,
        coltitle=black,
        left=1mm,
        right=1mm,
        parbox=false,
        nameref={##2},              % use \nameref{...} to display box title in reference
        before skip balanced=5mm,
        after skip balanced=5mm,
        interior style={
            top color=white,
            bottom color=white
        },
        underlay boxed title={

            \fill[#3]
                (title.north west) -- (title.north east) 
                cos +(\tcboxedtitleheight/2+4mm/2,-\tcboxedtitleheight/2)
                sin +(\tcboxedtitleheight/2+4mm/2,-\tcboxedtitleheight/2)
                -- (title.south west) -- +(-\tcboxedtitleheight-4mm, 0)
                cos +(-\tcboxedtitleheight/2-4mm/2,\tcboxedtitleheight/2)
                sin +(\tcboxedtitleheight/2+4mm/2,\tcboxedtitleheight/2)
                ;
        },
        IfEmptyTF={##2}{    % ##2 gets replaced with #2 inside the macro
            title={#2 \thetcbcounter}
        }
        {
            title={#2 \thetcbcounter: ##2}
        }
    }
}

% \xdef\italianBoxes{
%     frameddefn / Definizione / black!20!green!30,
%     framedprinc / Principio / orange!60,
%     framedthm / Teorema / red!40,
%     framedprop / Proposizione / black!20!blue!30,
%     framedlem / Lemma / purple!40,
%     framedcor / Corollario / pink!75,
%     framedobs / Osservazione / orange!30,
%     framedprob / Problema / black!20!cyan!30,
%     framedmeth / Metodo / gray!30,
%     framedalgo / Algoritmo / gray!30
% }

% \foreach \boxid / \boxname / \boxcolor in \italianBoxes {  
%     \newcustomtcbox{\unexpanded{\boxid}}{\unexpanded{\boxname}}{\unexpanded{\boxcolor}}
% }

\if\useItalian1
    \newcustomtcbox{frameddefn}{Definizione}{black!20!green!30}
    \newcustomtcbox{framedprinc}{Principio}{orange!60}
    \newcustomtcbox{framedthm}{Teorema}{red!40}
    \newcustomtcbox{framedprop}{Proposizione}{black!20!blue!30}
    \newcustomtcbox{framedlem}{Lemma}{purple!40}
    \newcustomtcbox{framedcor}{Corollario}{pink!75}
    \newcustomtcbox{framedobs}{Osservazione}{orange!30}
    \newcustomtcbox{framedprob}{Problema}{black!20!cyan!30}
    \newcustomtcbox{framedmeth}{Metodo}{gray!30}
    \newcustomtcbox{framedalgo}{Algoritmo}{gray!30}

    % AMS Math

    \theoremstyle{definition}
    \newtheorem{example}{Esempio}[subsection]

    \theoremstyle{definition}
    \newtheorem{nonexample}{Non esempio}[subsection]
\else
    \newcustomtcbox{frameddefn}{Definition}{black!20!green!30}
    \newcustomtcbox{framedprinc}{Principle}{orange!60}
    \newcustomtcbox{framedthm}{Theorem}{red!40}
    \newcustomtcbox{framedprop}{Proposition}{black!20!blue!30}
    \newcustomtcbox{framedlem}{Lemma}{purple!40}
    \newcustomtcbox{framedcor}{Corollary}{pink!75}
    \newcustomtcbox{framedobs}{Observation}{orange!30}
    \newcustomtcbox{framedprob}{Problem}{black!20!cyan!30}
    \newcustomtcbox{framedmeth}{Method}{gray!30}
    \newcustomtcbox{framedalgo}{Algorithm}{gray!30}

    % AMS Math

    \theoremstyle{definition}
    \newtheorem{example}{Example}[subsection]

    \theoremstyle{definition}
    \newtheorem{nonexample}{Non-example}[subsection]
\fi

